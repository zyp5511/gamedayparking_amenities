<!DOCTYPE html>
{% load staticfiles %}

<html lang="en" style="height:100%;">
    <head>
        {% include "header.html" %}
        <link   rel="stylesheet" 
                href="{% static "bower_components/bootstrap/dist/css/bootstrap.min.css" %}">
        <script src="http://maps.google.com/maps/api/js?sensor=false" 
                type="text/javascript"></script>
        
        <style>
            body {
                width:100%;
                min-height:100%;
            }

            #bodyContainer {
                width:100%;
                height:800px;
                margin-top:-20px;
            }

            #filterContainer {
                background-color:#EAEAEA;
                width:100%;
                height:70px;
                padding-top:22px;
                padding-bottom:10px;
                text-align:center;
                border-style:inset;
                border-width:1px;
                border-right-width:0px;
                border-left-width:0px;
                border-color:lightgrey;
            }

            #checkboxForm {
                display:inline-block; 
                margin-left:30px;
            }

            .filterCheckBox {
                display:inline-block;
            }

            .filterCheckBoxLabel {
                display:inline-block; 
                vertical-align:middle; 
                margin-right:10px;
            }

            #mapContainer {
                width:47%; 
                height:100%; 
                margin-top:1px; 
                float:right;
            }

            #cost_low {
                margin-right:5px;
            }

            #cost_high, #dist_low {
                margin-right:5px; 
                margin-left:5px;
            }

            #dist_high {
                margin-left:5px;
            }

            #map {
                height:100%; 
                width:100%;
            }

            #parkingSpotsContainer {
                width:53%; 
                height:100%; 
                float:left; 
            }

            #parkingContainer {
                text-align:center;
                margin-top:30px;
                width:100%;
            }

            .parkingSpots {
                display:inline-block;
                width:325px; 
                margin-bottom:30px;
                margin-right:15px;
                margin-left:15px;
                border-style:solid;
                border-color:grey;
                border-width:1px;
                -webkit-box-shadow: 0 8px 6px -7px grey;
                -moz-box-shadow: 0 8px 6px -7px grey;
                box-shadow: 0 8px 6px -7px grey;
            }

            .parkingImageContainer, .parkingImage {
                display:inline-block; 
                width:100%; 
                height:200px; 
                float:left;
                border-style:solid;
                border-color:lightgrey;
                border-width:0px;
                border-bottom-width:1px;
            }

            .streetAddress {
                float:left;
                padding-left:10px;
                text-decoration:underline;
            }

            .popUpLink:visited  {color:black; text-decoration:none; background-color:none;}
            .popUpLink:link     {color:black; text-decoration:none; background-color:none;}
            .popUpLink:hover    {color:blue; text-decoration:none; background-color:none;}
            .popUpLink:active   {color:red; text-decoration:underline; background-color:none;}

            .reviewRating {
                float:left;
                clear:left;
                padding-left:10px;
            }

            .descriptionContainer {
                float:left;
                clear:left;
                padding-left:10px;
                font-style:italic;
            }

            .ontop {
                z-index:999;
                width:100%;
                height:100%;
                top:0;
                left:0;
                display:none;
                position:fixed;
                background-color:rgba(40,40,40,0.9);
                color:#000000;
                /*filter:alpha(opacity = 50);
                opacity: .9;*/
            }

            .popup {
                width:500px;
                height:400px;
                position:absolute;
                color:#000000;
                background-color:white;
                /* To align popup window at the center of screen*/
                top:50%;
                left:50%;
                margin-top:-200px;
                margin-left:-250px;
            }
        </style>
    </head>
    
    <body>
        {% block nav_bar %}{% endblock %}
        <div id="bodyContainer">
            <div id="filterContainer">
                <button id="cost_low" onclick="sort_cost_low()">Cost Low to High</button>
                <button id="cost_high" onclick="sort_cost_high()">Cost High To Low</button>
                <button id="dist_low" onclick="sort_dist_low()">Distance Low to High</button>
                <button id="dist_high" onclick="sort_dist_high()">Distance High to Low</button>
                
                <FORM id="checkboxForm" NAME="amenities">
                    <INPUT  class="filterCheckBox" 
                            TYPE="checkbox" 
                            id="filter_grill" 
                            name="grill" 
                            onClick="filter_grill_func()" /> 
                    <label  class="filterCheckBoxLabel" 
                            for="grill">Grill</label>

                    <INPUT  class="filterCheckBox" 
                            TYPE="checkbox" 
                            id="filter_bathroom" 
                            name="bathroom" 
                            onClick="filter_bathroom_func()" />
                    <label  class="filterCheckBoxLabel" 
                            for="bathroom">Bathroom</label>

                    <INPUT  class="filterCheckBox" 
                            TYPE="checkbox" 
                            id="filter_yard" 
                            name="yard" 
                            onClick="filter_yard_func()" />
                    <label  class="filterCheckBoxLabel" 
                            for="yard">Yard</label>

                    <INPUT  class="filterCheckBox" 
                            TYPE="checkbox" 
                            id="filter_table" 
                            name="table" 
                            onClick="filter_table_func()" />
                    <label  class="filterCheckBoxLabel" 
                            for="table">Table</label>

                    <INPUT  class="filterCheckBox" 
                            TYPE="checkbox" 
                            id="filter_electricity" 
                            name="electricity" 
                            onClick="filter_electricity_func()" /> 
                    <label  class="filterCheckBoxLabel" 
                            for="electricity">Electricity</label>
                </FORM>
            </div>

            <div id="mapContainer">
                <div id="map"></div>

                <!-- Script to implement googe maps block -->
                <script>    
                    var map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 10,
                            center: new google.maps.LatLng({{center_lon}},{{center_lat}}),
                            mapTypeId: google.maps.MapTypeId.ROADMAP
                    });
                    
                    var infowindow = new google.maps.InfoWindow();
                    var parkingspots = {{ json_parkingspots|safe }};
                    var i, marker;
                   
                    for (i = 0; i < parkingspots.length; i++) {
                           marker = new google.maps.Marker({
                           position: new google.maps.LatLng(parkingspots[i].location.longitude, parkingspots[i].location.latitude),
                           map: map
                        });
                    var listAmenities =parkingspots[i].amenities;
                    var amenitiesPopUp=''
                    for(var k in listAmenities)
                    {
                        if(listAmenities[k]==true)
                        {
                            amenitiesPopUp+=k+' ';
                        }
                    }
                        google.maps.event.addListener(marker, 'click', (function(marker, i) {
                            return function() {
                              infowindow.setContent(

                                                    //not responsive
                                                   '<div id="popContainer" style="width:400px; min-height:300px;">'+
                                                  '<img src="/static'+parkingspots[i].photos +'" height="50%" width="50%">'+
                                                   '<h4>' + parkingspots[i].street_address+'</h4>'+
                                                   '<p><b>Cost:</b></p>'+
                                                    '<p>$' + parkingspots[i].cost+'</p>'+
                                                    '<p><b>Amenities:</b></p>'+
                                                    '<p>' + amenitiesPopUp+'</p>'+
                                                   '<p><b>Description:</b></p>'+
                                                    '<p>' + parkingspots[i].description+'</p>'
                                                  );
                            infowindow.open(map, marker);
                            }
                        })(marker, i));
                    }
                </script>
            </div>
            
            <div id="parkingSpotsContainer">
                <div id="parkingContainer">
                    {% for x in parkingspots %}
                        <div class="parkingSpots">
                            <p class="parkingImageContainer">
                                <img class="parkingImage" src="{% static "media/default.png" %}" alt="Parking Image">
                            </p>
                            <a class="popUpLink" href="#" onClick="pop('popDiv')">
                                <p class="streetAddress">{{ x.street_address }}, {{ x.city }}, {{ x.state }}</p>
                            </a>
                            <p class="reviewRating"><b>Review:&nbsp</b></p>
                            <p class="descriptionContainer">{{ x.description }}</p>
                            <div id="popDiv" class="ontop">
                                <div class="popup">
                                    <h4> {{x.street_address}}</h4>
                                    <p><b>Cost:</b></p>
                                    <p>{{x.cost}}</p>
                                    <p><b>Description:</b></p>
                                    <p>{{x.description}}</p>
                                    <a href="#" onClick="hide('popDiv')">Close</a>
                                </div>
                                <!--<table border="1" id="popup">
                                    <tr>
                                        <td>
                                            Click Close OR escape button to close it
                                            
                                        </td>
                                    </tr>
                                </table>-->
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Prints footer -->
        {% include "footer.html" %}

        <!-- SCRIPTS BEGIN-->

        <!-- Script to implement Filter functions:
        This could be optimized with a check for narrow or widen scope on filter, 
        and always using the current list, which shouldn't have to be resorted (unless widen scope) -->
        <script type="text/javascript">
            var last_sort = "sort_dist_low";
            var global_list = {{ json_parkingspots|safe }}
            var curr_list = {{json_parkingspots|safe }}
            function filter_and_sort_list() {
                curr_list = global_list.slice(); //used to copy global_list
                // get checkbox values
                yard_checked = document.getElementById("filter_yard").checked
                bathroom_checked = document.getElementById("filter_bathroom").checked
                table_checked = document.getElementById("filter_table").checked
                electricity_checked = document.getElementById("filter_electricity").checked
                grill_checked = document.getElementById("filter_grill").checked

                if (yard_checked)
                    curr_list = curr_list.filter(filter_by_yard)
                if (bathroom_checked)
                    curr_list = curr_list.filter(filter_by_bathroom)
                if (table_checked) 
                    curr_list = curr_list.filter(filter_by_table)
                if (electricity_checked)
                    curr_list = curr_list.filter(filter_by_electricity)
                if (grill_checked)
                    curr_list = curr_list.filter(filter_by_grill)

                switch (last_sort) {
                case "sort_cost_low":
                    curr_list.sort(sort_by_low_cost);
                    break;
                case "sort_cost_high":
                    curr_list.sort(sort_by_high_cost);
                    break;
                case "sort_dist_low":
                    curr_list.sort(sort_by_low_distance);
                    break;
                case "sort_dist_high":
                    curr_list.sort(sort_by_high_distance);
                    break;
                case "sort_rating_low":
                    curr_list.sort(sort_by_low_rating);
                    break;
                case "sort_rating_high":
                    curr_list.sort(sort_by_high_rating);
                    break;
                default:
                    document.write("No last sort");
                }
                updateParkingList(curr_list);
            }
            
            function filter_yard_func () {
                filter_yard_check = document.getElementById("filter_yard").checked;
                if (filter_yard_check) {
                    curr_list = curr_list.filter(filter_by_yard);
                    updateParkingList(curr_list);
                }
                else {
                    filter_and_sort_list();
                }
            }
            function filter_bathroom_func () {
                filter_bathroom_check = document.getElementById("filter_bathroom").checked;
                if (filter_bathroom_check) {
                    curr_list = curr_list.filter(filter_by_bathroom);
                    updateParkingList(curr_list);
                }
                else {
                    filter_and_sort_list();
                }
            }
            function filter_grill_func () {
                filter_grill_check = document.getElementById("filter_grill").checked;
                if (filter_grill_check) {
                    curr_list = curr_list.filter(filter_by_grill);
                    updateParkingList(curr_list);
                }
                else {
                    filter_and_sort_list();
                }
            }
            function filter_electricity_func () {
                filter_electricity_check = document.getElementById("filter_electricity").checked;
                if (filter_electricity_check) {
                    curr_list = curr_list.filter(filter_by_electricity);
                    updateParkingList(curr_list);
                }
                else {
                    filter_and_sort_list();
                }
            }
            function filter_table_func () {
                filter_table_check = document.getElementById("filter_table").checked;
                if (filter_table_check) {
                    curr_list = curr_list.filter(filter_by_table);
                    updateParkingList(curr_list);
                }
                else {
                    filter_and_sort_list();
                }
            }
            function sort_cost_low() {
                last_sort = "sort_cost_low"
                curr_list.sort(sort_by_low_cost)
                updateParkingList(curr_list);
            }
            function sort_cost_high() {
                last_sort = "sort_cost_high"
                curr_list.sort(sort_by_high_cost)
                updateParkingList(curr_list);
            }
            function sort_dist_low() {
                last_sort = "sort_dist_low"
                curr_list.sort(sort_by_low_distance)
                updateParkingList(curr_list);
            }
            function sort_dist_high() {
                last_sort = "sort_dist_high"
                curr_list.sort(sort_by_high_distance)
                updateParkingList(curr_list);
            }
            function sort_rating_low() {
                last_sort = "sort_rating_low"
                curr_list.sort(sort_by_low_rating)
                updateParkingList(curr_list);
            }
            function sort_rating_high() {
                last_sort = "sort_rating_high"
                curr_list.sort(sort_by_high_rating)
                updateParkingList(curr_list);
            }
            function updateParkingList(curr_list) {
                var content = "";
                for (i = 0; i < curr_list.length; i++) {
                    content += "<div class='parkingSpots'>";
                    content += "<p class='parkingImageContainer'>";
                    content += "<img class='parkingImage' src=\"/static" + parkingspots[i].photos + '\" alt="Parking Image"></p>';
                    content += "<a href='#' onClick=\"pop('popDiv')\">";
                    content += "<p class='streetAddress' style='color:black;'>" + curr_list[i].street_address + ",&nbsp" + curr_list[i].city + ",&nbsp" + curr_list[i].state + "</p></a>";
                    content += "<p class='reviewRating'><b>Review:&nbsp</b></p>";
                    content += "<p class='descriptionContainer'>" + curr_list[i].description + "</p>";
                    content += "<div id='popDiv' class='ontop' align='center'>";
                    content += "<div id='popup'>";
                    content += "<h4>" + curr_list[i].street_address + "</h4>";
                    content += "<p><b>Cost:</b></p>";
                    content += "<p>" + curr_list[i].cost + "</p>";
                    content += "<p><b>Description:</b></p>";
                    content += "<p>" + curr_list[i].description + "</p>";
                    content += "<a href='#' onClick=\"hide('popDiv')\">Close</a>";
                    content += "</div></div></div>";
                }
                document.getElementById("parkingContainer").innerHTML = content;
            }
        </script>

        <script type="text/javascript">
            function pop(div) {
                document.getElementById(div).style.display = 'block';
            }
            function hide(div) {
                document.getElementById(div).style.display = 'none';
            }
            //To detect escape button
            document.onkeydown = function(evt) {
                evt = evt || window.event;
                if (evt.keyCode == 27) {
                    hide('popDiv');
                }
            };
        </script>

        <script src="{% static "bower_components/jquery/dist/jquery.min.js" %}"></script>
        <script src="{% static "bower_components/bootstrap/dist/js/bootstrap.min.js" %}"></script>
        <script src="{% static "js/parking_sort.js" %}"></script>

        <!-- SCRIPTS END -->
    </body>
    
</html>
