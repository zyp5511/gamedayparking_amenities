<!DOCTYPE html>
{% load staticfiles %}
<html lang="en" ng-app="TestApp">
    <head>  
        <title>Search Results</title>

        <link   rel="stylesheet" 
                href="{% static "bower_components/bootstrap/dist/css/bootstrap.min.css" %}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" 
                integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" 
                crossorigin="anonymous"></script>

        <style type="text/css">
            html, body {
                width:100%;
                height:100%;
            }

            .container {
                display:block;
                margin-top:-20px;
                padding-top:20px;
                height:90%;
            }

            /* Profile container */
            .profile {
                display:block;
                margin:20px 0;
                height:80%;
            }

            /* Profile sidebar */
            .profile-sidebar {
                padding: 20px 0 10px 0;
                background: #fff;
            }

            .profile-userpic img {
                float: none;
                margin: 0 auto;
                width: 50%;
                height: 50%;
                -webkit-border-radius: 50% !important;
                -moz-border-radius: 50% !important;
                border-radius: 50% !important;
            }

            .profile-usertitle {
              text-align: center;
              margin-top: 20px;
            }

            .profile-usertitle-name {
                color: #5a7391;
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 7px;
            }

            .profile-usertitle-job {
                text-transform: uppercase;
                color: #5b9bd1;
                font-size: 12px;
                font-weight: 600;
                margin-bottom: 15px;
            }
                
            .profile-usermenu {
                margin-top: 30px;
            }

            .profile-usermenu ul li {
                border-bottom: 1px solid #f0f4f7;
            }

            .profile-usermenu ul li:last-child {
                border-bottom: none;
            }

            .profile-usermenu ul li a {
                color: #93a3b5;
                font-size: 14px;
                font-weight: 400;
            }

            .profile-usermenu ul li a i {
                margin-right: 8px;
                font-size: 14px;
            }

            .profile-usermenu ul li a:hover {
                background-color: #fafcfd;
                color: #5b9bd1;
            }

            .profile-usermenu ul li.active {
                border-bottom: none;
            }

            .profile-usermenu ul li.active a {
                color: #5b9bd1;
                background-color: #f6f9fb;
                border-left: 2px solid #5b9bd1;
                margin-left: -2px;
            }

            #messagesContainer {
                display:block;
                height:100%;
            }

            #messagesDiv {
                display:block;
                height:100%;
                overflow-y:auto;
            }

            .nav-tabs .glyphicon:not(.no-margin) { 
                margin-right:10px; 
            }

            .tab-pane .list-group {
                margin-bottom:0px;
            }

            .tab-pane .list-group .glyphicon { 
                margin-right:5px; 
            }

            .tab-pane .list-group .glyphicon:hover { 
                color:#FFBC00; 
            }

            a.list-group-item.read { 
                color: #222;background-color: #F3F3F3; 
            }

            .ontop {
                z-index:999;
                width:100%;
                height:100%;
                top:0;
                left:0;
                display:none;
                position:fixed;
                background-color:rgba(40,40,40,.5);
                color:#000000;
            }

            .popup {
                width:600px;
                height:350px;
                position:absolute;
                color:#000000;
                background-color:#4da5ff;
                /* To align popup window at the center of screen*/
                top:50%;
                left:45%;
                margin-top:-200px;
                margin-left:-250px;
            }

            #popUpHeader {
                text-align:left;
                padding-left:15px;
            }

            #popUpHeader span {
                display:inline-block;
                color:white;
                width:100%;
                font-size:20px;
                font-weight:bold;
                margin-top:8px;
            }

            #popUpMainContainer {
                position:absolute;
                top:40px;
                bottom:0;
                left:0px;
                right:0px;
                background-color:white;
            }

            #replyForm {
                position:absolute;
                display:inline-block;
                text-align:right;
                top:0;
                left:0;
                right:0;
                bottom:0;
                padding-right:25px;
                padding-top:22px;
            }

            .fieldContainers {
                display:inline-block;
                width:100%;
                height:auto;
                margin-top:5px;
                margin-bottom:5px;
            }

            .inputLabels {
                display:inline-block;
                padding-top:7px;
            }

            #owner {
                display:inline-block;
                font-weight:bold;
                width:450px;
                height:35px;
                float:right;
                margin-left:10px;
                padding-left:10px;
                border-style:solid;
                border-width:1px;
                border-color:lightblue;
                border-radius:3px;
            }

            #subject {
                display:inline-block;
                width:450px;
                height:35px;
                float:right;
                margin-left:10px;
                padding-left:10px;
                border-style:solid;
                border-width:1px;
                border-color:lightblue;
                border-radius:3px;
            }

            #replyMessage {
                display:inline-block;
                width:450px;
                height:120px;
                float:right;
                margin-left:10px;
                margin-bottom:12px;
                padding-left:10px;
                padding-top:5px;
                border-style:solid;
                border-width:1px;
                border-color:lightblue;
            }

            #replyButton {
                background-color:#4da5ff;
                color:white;
                width:120px;
                height:40px;
                margin-left:8px;
                border-style:solid;
                border-width:1px;
                border-color:#4da5ff;
                border-radius:5px;
            }

            #popupCancel {
                width:120px;
                height:40px;
                margin-right:8px;
                border-style:solid;
                border-width:1px;
                border-color:lightgrey;
                border-radius:5px;
            }
        </style>
    </head>

    <body>
        {% include "header.html" %}

        <div class="container">
            <div class="row profile">
                <div class="col-md-3">
                    <div class="profile-sidebar">
                        <!-- BEGIN SIDEBAR USERPIC -->
                        <div class="profile-userpic">
                            <img  src="http://keenthemes.com/preview/metronic/theme/assets/admin/pages/media/profile/profile_user.jpg" 
                                  class="img-responsive" 
                                  alt="Profile Picture">
                        </div>
                        <!-- END SIDEBAR USERPIC -->

                        <!-- BEGIN SIDEBAR USER TITLE -->
                        <div class="profile-usertitle">
                            <div class="profile-usertitle-name">
                                {{ user.username }}
                            </div>

                            <div class="profile-usertitle-job">
                                <!-- normal users or admin-->
                                {% if user.extendeduser.adminuser.registered%}
                                    ADMIN
                                {% else %}
                                    COMMON USER
                                {% endif %}
                            </div>
                        </div>
                        <!-- END SIDEBAR USER TITLE -->

                        <!-- BEGIN SIDEBAR MENU -->
                        <div class="profile-usermenu">
                            <ul class="nav">
                                <li class="active" id="messagesTab" >
                                    <a href="#" onclick="showMessages()"><i class="glyphicon glyphicon-home"></i>Messages </a>
                                </li>

                                <li class="" id="parkingSpotsTab">
                                    <!-- normal users or admin-->
                                    {% if user.extendeduser.adminuser.registered%}
                                         <a href="#" onclick="showParkingSpots()"><i class="glyphicon glyphicon-flag"></i>Parking Spots </a>
                                    {% else %}
                                        
                                    {% endif %}
                                </li>

                                <li class="" id="pendingResTab">
                                    <a href="#" onclick="showPendingReservations()"><i class="glyphicon glyphicon-ok"></i>Pending Reservations </a>
                                </li>

                                <li class="" id="pendingReqTab">
                                    <!-- normal users or admin-->
                                    {% if user.extendeduser.adminuser.registered%}
                                         <a href="#" onclick="showPendingRequests()"><i class="glyphicon glyphicon-flag"></i>Pending Requests</a>
                                    {% else %}
                                        
                                    {% endif %}
                                </li>

                                <li class="" id="accountSettingsTab">
                                    <a href="../accounts/password/change" onclick="showAccountSettings()"><i class="glyphicon glyphicon-user"></i>Account Settings</a>
                                </li>
                            </ul>
                        </div>
                        <!-- END SIDEBAR MENU -->
                    </div>
                </div>

                <div class="col-md-9" id="messagesContainer">
                    <!-- BEGIN MESSAGES TAB -->
                    <ul class="nav nav-tabs" id="myTab">
                        <li class="active"><a href="#message" data-toggle="tab"><b>Messages</b></a></li>
                    </ul>

                    <div class="tab-content" id="messagesDiv">
                        <div class="tab-pane fade in active" id="message">
                            {% if messages %}
                                {% for x in messages %}
                                <div class="list-group" onClick="pop('popDiv{{x.id}}')">
                                        <a href="#" class="list-group-item">
                                            <span class="name" style="min-width:120px; display:inline-block;">
                                                <b style="color:#4da5ff;">{{x.sender}}</b>
                                            </span> 

                                            <span class="">
                                                {{x.subject}}
                                            </span>

                                            <span class="badge">
                                                {{x.date}}
                                            </span>

                                            <br />

                                            <span  id="messageSpan" class="text-muted" style="font-size: 11px;">
                                                {{x.message}}
                                            </span>  
                                        </a>
                                    </div>

                                    <div id="popDiv{{x.id}}" class="ontop">
                                        <div class="popup">
                                            <div id="popUpHeader">
                                                <span>Reply Owner</span>
                                            </div>

                                            <div id="popUpMainContainer">
                                                <form id="replyForm" action="../reply/" method="post">
                                                    <input type="hidden" name="pid" value={{x.sender.id}}>
                                                    <div class="fieldContainers">
                                                        <label  class="inputLabels"
                                                                for="owner">To: </label>
                                                        <input  id="owner"
                                                                type="text"
                                                                name="owner"
                                                                value="{{ x.sender }}">
                                                    </div>
                                                    <br/>
                                                    <div class="fieldContainers">
                                                        <label  class="inputLabels"
                                                                for="subject">Subject: </label>
                                                        <input  type="text" 
                                                                name="subject"
                                                                id="subject"
                                                                class="subject"
                                                                value="RE: {{ x.subject }}">
                                                    </div>
                                                    <br/>
                                                    <div class="fieldContainers">
                                                        <label  class="inputLabels"
                                                                for="message">Message: </label>
                                                        <textarea   id="replyMessage"
                                                                    name="message"
                                                                    maxlength="3000">&#13;&#10;&#13;&#10;&#13;&#10;-------------------------------------------------&#13;&#10;{{x.message}}</textarea>
                                                    </div>
                                                    <br />
                                                    <button id="popupCancel" 
                                                            type="button"
                                                            onClick="hide('popDiv{{x.id}}')">Cancel</button>

                                                    <input  id="replyButton" 
                                                            type="submit"
                                                            value="Send Reply">
                                                    {% csrf_token%}
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                  <h3> NO MESSAGE</h3>
                            {% endif %}
                        </div>  
                    </div>
                    <!-- END MESSAGES TAB -->
                </div>
            </div>
        </div>

        <script>
            //Function To Display Popup
            function pop(div) {
                document.getElementById(div).style.display = 'block';
            }

            //Function to close popup
            function hide(div) {
                document.getElementById(div).style.display = 'none';
            }

            //To detect escape button
            document.onkeydown = function(evt) {
                evt = evt || window.event;
                if (evt.keyCode == 27) {
                    hide('popDiv');
                }
            };

            function showMessages() {
                // Change Active Displays
                document.getElementById('myTab').style.display = 'block';
                document.getElementById('messagesDiv').style.display = 'block';

                // Change Active Tabs
                document.getElementById('messagesTab').className = 'active';
                document.getElementById('parkingSpotsTab').className = '';
                document.getElementById('pendingResTab').className = '';
                document.getElementById('pendingReqTab').className = '';
                document.getElementById('accountSettingsTab').className = '';
            }

            function showParkingSpots() {
                // Change Active Displays
                document.getElementById('myTab').style.display = 'none';
                document.getElementById('messagesDiv').style.display = 'none';

                // Change Active Tabs
                document.getElementById('messagesTab').className = '';
                document.getElementById('parkingSpotsTab').className = 'active';
                document.getElementById('pendingResTab').className = '';
                document.getElementById('pendingReqTab').className = '';
                document.getElementById('accountSettingsTab').className = '';
            }

            function showPendingReservations() {
                // Change Active Displays
                document.getElementById('myTab').style.display = 'none';
                document.getElementById('messagesDiv').style.display = 'none';

                // Change Active Tabs
                document.getElementById('messagesTab').className = '';
                document.getElementById('parkingSpotsTab').className = '';
                document.getElementById('pendingResTab').className = 'active';
                document.getElementById('pendingReqTab').className = '';
                document.getElementById('accountSettingsTab').className = '';
            }

            function showPendingRequests() {
                // Change Active Displays
                document.getElementById('myTab').style.display = 'none';
                document.getElementById('messagesDiv').style.display = 'none';

                // Change Active Tabs
                document.getElementById('messagesTab').className = '';
                document.getElementById('parkingSpotsTab').className = '';
                document.getElementById('pendingResTab').className = '';
                document.getElementById('pendingReqTab').className = 'active';
                document.getElementById('accountSettingsTab').className = '';
            }

            function showAccountSettings() {
                // Change Active Displays
                document.getElementById('myTab').style.display = 'none';
                document.getElementById('messagesDiv').style.display = 'none';

                // Change Active Tabs
                document.getElementById('messagesTab').className = '';
                document.getElementById('parkingSpotsTab').className = '';
                document.getElementById('pendingResTab').className = '';
                document.getElementById('pendingReqTab').className = '';
                document.getElementById('accountSettingsTab').className = 'active';
            }
        </script>    
    </body>
</html> 

